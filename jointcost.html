<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Joint Product Cost Allocation</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  table { border-collapse: collapse; margin-top: 20px; width: 100%; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
  th { background: #f8f8f8; }
  select, input { padding: 5px; margin: 5px; }
  .container { max-width: 900px; margin: auto; }
</style>
</head>
<body>

<div class="container">
<h1>Joint Product Cost Allocation</h1>
<p>Change the allocation base to see costs reallocated instantly.</p>

<label>Total Joint Cost: </label>
<input type="number" id="totalCost" value="30000"><br>

<label>Allocation Base: </label>
<select id="allocationBase">
  <option value="physical">Physical Units</option>
  <option value="sales">Sales Value at Split-off</option>
  <option value="nrv">Net Realizable Value (NRV)</option>
</select>

<h3>Product Data</h3>
<table>
  <thead>
    <tr>
      <th>Product</th>
      <th>Units</th>
      <th>Selling Price @ Split-off</th>
      <th>Separable Costs</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Product A</td>
      <td><input type="number" id="unitsA" value="100"></td>
      <td><input type="number" id="priceA" value="50"></td>
      <td><input type="number" id="sepA" value="200"></td>
    </tr>
    <tr>
      <td>Product B</td>
      <td><input type="number" id="unitsB" value="200"></td>
      <td><input type="number" id="priceB" value="40"></td>
      <td><input type="number" id="sepB" value="300"></td>
    </tr>
    <tr>
      <td>Product C</td>
      <td><input type="number" id="unitsC" value="150"></td>
      <td><input type="number" id="priceC" value="60"></td>
      <td><input type="number" id="sepC" value="150"></td>
    </tr>
  </tbody>
</table>

<canvas id="allocationChart" width="400" height="200"></canvas>

<h3>Allocation Table</h3>
<table>
  <thead>
    <tr>
      <th>Product</th>
      <th>Allocated Cost</th>
      <th>% of Total</th>
      <th>Cost per Unit</th>
    </tr>
  </thead>
  <tbody id="resultsTable"></tbody>
</table>
</div>

<script>
const ctx = document.getElementById('allocationChart').getContext('2d');
let chart;

function calculateAllocation() {
  const totalCost = parseFloat(document.getElementById('totalCost').value);
  const base = document.getElementById('allocationBase').value;

  const products = [
    {
      name: "Product A",
      units: parseFloat(document.getElementById('unitsA').value),
      price: parseFloat(document.getElementById('priceA').value),
      sepCost: parseFloat(document.getElementById('sepA').value)
    },
    {
      name: "Product B",
      units: parseFloat(document.getElementById('unitsB').value),
      price: parseFloat(document.getElementById('priceB').value),
      sepCost: parseFloat(document.getElementById('sepB').value)
    },
    {
      name: "Product C",
      units: parseFloat(document.getElementById('unitsC').value),
      price: parseFloat(document.getElementById('priceC').value),
      sepCost: parseFloat(document.getElementById('sepC').value)
    }
  ];

  let baseValues;
  if (base === "physical") {
    baseValues = products.map(p => p.units);
  } else if (base === "sales") {
    baseValues = products.map(p => p.units * p.price);
  } else if (base === "nrv") {
    baseValues = products.map(p => (p.units * p.price) - p.sepCost);
  }

  const totalBase = baseValues.reduce((a, b) => a + b, 0);
  const allocations = baseValues.map(val => (val / totalBase) * totalCost);

  // Update table
  const tableBody = document.getElementById('resultsTable');
  tableBody.innerHTML = "";
  products.forEach((p, i) => {
    const percent = (allocations[i] / totalCost * 100).toFixed(2) + "%";
    const costPerUnit = (allocations[i] / p.units).toFixed(2);
    tableBody.innerHTML += `
      <tr>
        <td>${p.name}</td>
        <td>${allocations[i].toFixed(2)}</td>
        <td>${percent}</td>
        <td>${costPerUnit}</td>
      </tr>
    `;
  });

  // Update chart
  if (chart) {
    chart.destroy();
  }
  chart = new Chart(ctx, {
    type: 'pie',
    data: {
      labels: products.map(p => p.name),
      datasets: [{
        data: allocations,
        backgroundColor: ['#007bff', '#28a745', '#ffc107']
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { position: 'bottom' },
        title: { display: true, text: 'Joint Cost Allocation' }
      }
    }
  });
}

// Event listeners
document.querySelectorAll('input, select').forEach(el => {
  el.addEventListener('input', calculateAllocation);
});

calculateAllocation();
</script>

</body>
</html>
