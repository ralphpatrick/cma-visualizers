<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Pinoy Plate — Weekly Meal Planner</title>
<link rel="preconnect" href="https://panlasangpinoy.com">
<meta name="referrer" content="no-referrer"><!-- hotlink fix -->
<style>
  :root{
    --ink:#111; --muted:#6e6e73; --bg:#fff; --card:#f5f5f7;
    --accent:#0071e3; --ring: rgba(0,113,227,.2); --radius:18px;
  }
  *{box-sizing:border-box}
  html,body{margin:0;background:var(--bg);color:var(--ink);
    font:16px/1.45 -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji",sans-serif}
  a{color:inherit;text-decoration:none}
  .wrap{max-width:1200px;margin:auto;padding:32px 20px}
  header{display:grid;gap:10px;align-items:end;margin:18px 0 26px}
  header h1{font-size:clamp(26px,4vw,44px);letter-spacing:-.02em;margin:0;font-weight:700}
  header p{margin:0;color:var(--muted);font-size:clamp(14px,2.2vw,18px)}
  .toolbar{display:flex;gap:10px;align-items:center;justify-content:space-between;margin:18px 0 8px}
  .search{flex:1;position:relative}
  .search input{width:100%;padding:12px 14px;border-radius:12px;border:1px solid rgba(0,0,0,.12);outline:none}
  .search input:focus{box-shadow:0 0 0 6px var(--ring);border-color:var(--accent)}
  .chips{display:flex;gap:8px;flex-wrap:wrap}
  .chip{padding:8px 12px;background:var(--card);border-radius:999px;border:1px solid rgba(0,0,0,.08);font-size:13px;cursor:pointer}
  .chip.active{background:#e8f2ff;border-color:#cfe5ff;color:#0653b6}

  .slots{display:grid;grid-template-columns:repeat(5,1fr);gap:16px;margin:28px 0 10px}
  @media (max-width:900px){.slots{grid-template-columns:1fr}}
  .slot{
    min-height:120px;border-radius:var(--radius);padding:14px;background:linear-gradient(180deg,#fff, #fafafa);
    border:1.5px dashed rgba(0,0,0,.12); position:relative; display:flex;align-items:center;justify-content:center;
    transition:border-color .2s ease, background .2s ease, box-shadow .2s ease;
  }
  .slot.dragover{border-color:var(--accent);box-shadow:0 0 0 6px var(--ring)}
  .slot h3{position:absolute;top:10px;left:12px;margin:0;font-size:13px;color:var(--muted);font-weight:600;letter-spacing:.02em;text-transform:uppercase}
  .slot .chosen{display:flex;gap:12px;align-items:center}
  .slot .chosen img{width:64px;height:64px;border-radius:12px;object-fit:cover;border:1px solid rgba(0,0,0,.08)}
  .slot .chosen .label{display:flex;flex-direction:column}
  .slot .chosen .label strong{font-size:14px}
  .slot .chosen .label a{font-size:12px;color:var(--accent)}

  .grid{display:grid;grid-template-columns:repeat(5,1fr);gap:14px;min-height:200px}
  @media (max-width:1024px){.grid{grid-template-columns:repeat(4,1fr)}}
  @media (max-width:820px){.grid{grid-template-columns:repeat(3,1fr)}}
  @media (max-width:560px){.grid{grid-template-columns:repeat(2,1fr)}}
  .dish{background:var(--card);border-radius:var(--radius);overflow:hidden;display:flex;flex-direction:column;cursor:grab;user-select:none;border:1px solid rgba(0,0,0,.06)}
  .dish:active{transform:scale(.98)}
  .dish img{width:100%;aspect-ratio:4/3;object-fit:cover;display:block}
  .dish .meta{padding:10px 12px 12px}
  .dish .name{font-weight:600;font-size:14px;margin:0 0 2px}
  .dish .tag{font-size:12px;color:var(--muted)}
  .empty{color:var(--muted);text-align:center;padding:40px 0}

  .cta{margin-top:12px;display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  .btn{padding:10px 14px;background:var(--ink);color:#fff;border-radius:12px;border:none;font-weight:600;cursor:pointer}
  .btn[disabled]{opacity:.45;cursor:not-allowed}
  .btn.secondary{background:var(--card);color:var(--ink)}
  .note{color:var(--muted);font-size:12px}

  .reel-wrap{overflow:hidden;border-top:1px solid rgba(0,0,0,.08);background:#fff;margin-top:22px}
  .reel{display:flex;gap:18px;align-items:center;padding:18px;animation:scroll 40s linear infinite}
  .reel img{height:120px;width:auto;border-radius:16px;object-fit:cover;border:1px solid rgba(0,0,0,.06)}
  @keyframes scroll{from{transform:translateX(0)}to{transform:translateX(-50%)}}

  footer{color:var(--muted);font-size:12px;padding:22px;text-align:center}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Pinoy Plate</h1>
      <p>Plan your week the Apple‑clean way. Drag a recipe into each category. Click any photo to open the Panlasang Pinoy recipe.</p>
      <div class="toolbar">
        <div class="chips" id="chips"></div>
        <div class="search"><input id="query" type="search" placeholder="Search dishes (e.g., tapsilog, kare-kare, turon)" disabled></div>
      </div>
    </header>

    <!-- Slots strictly mapped to Panlasang Pinoy course groups -->
    <section class="slots" id="slots"></section>

    <section>
      <div class="cta">
        <button class="btn" id="surprise" disabled>Surprise me (match categories)</button>
        <button class="btn secondary" id="clearAll" disabled>Clear all</button>
        <span class="note">Photos/recipes © PanlasangPinoy.com • thumbnails link to their pages.</span>
      </div>
      <div class="grid" id="grid"><div class="empty" id="status">Loading recipes…</div></div>
    </section>
  </div>

  <!-- Rolling photo strip -->
  <div class="reel-wrap" aria-hidden="true">
    <div class="reel" id="reel"></div>
  </div>

  <footer>
    Built for personal study/planning. Place <code>pp-dishes.json</code> next to this file.
  </footer>

<script>
/* ========== CATEGORY LOCK ========== */
const CATEGORIES = ["Breakfast","Lunch","Appetizers","Dessert","Dinner"]; // Panlasang Pinoy header categories

/* ========== ELEMENTS & STATE ========== */
const $grid = document.getElementById('grid');
const $chips = document.getElementById('chips');
const $query = document.getElementById('query');
const $slots = document.getElementById('slots');
const $reel = document.getElementById('reel');
const $surprise = document.getElementById('surprise');
const $clearAll = document.getElementById('clearAll');
const $status = document.getElementById('status');

const state = { dishes:[], filter:"All", q:"", chosen:{} };

/* ========== UI BUILDERS ========== */
function buildChips(){
  $chips.innerHTML = "";
  ["All",...CATEGORIES].forEach(tag=>{
    const chip = document.createElement('button');
    chip.className = 'chip' + (tag==="All" ? " active":"");
    chip.textContent = tag;
    chip.onclick = ()=>{
      document.querySelectorAll('.chip').forEach(c=>c.classList.remove('active'));
      chip.classList.add('active');
      state.filter = tag;
      renderGrid();
    };
    $chips.appendChild(chip);
  });
}

function renderSlots(){
  $slots.innerHTML = "";
  CATEGORIES.forEach(cat=>{
    const div = document.createElement('div');
    div.className = 'slot';
    div.dataset.slot = cat;
    div.innerHTML = `<h3>${cat}</h3><div class="placeholder">Drop a ${cat.toLowerCase()} dish here</div>`;
    $slots.appendChild(div);
  });
  enableDrop();
}

function fallbackSVG(label="Image unavailable"){
  const t = encodeURIComponent(label);
  return `data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='400' height='300'><rect width='400' height='300' fill='%23f5f5f7'/><text x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-family='-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial' font-size='14' fill='%236e6e73'>${t}</text></svg>`;
}

function cardHTML(d){
  return `
  <article class="dish" draggable="true" data-name="${d.name}">
    <a href="${d.url}" target="_blank" rel="noopener">
      <img src="${d.img}" alt="${d.name}" loading="lazy"
           referrerpolicy="no-referrer"
           onerror="this.onerror=null;this.src='${fallbackSVG('Image unavailable')}';" />
    </a>
    <div class="meta">
      <p class="name">${d.name}</p>
      <div class="tag">${d.category}</div>
    </div>
  </article>`;
}

function renderGrid(){
  if(!state.dishes.length){
    $grid.innerHTML = `<div class="empty">No recipes found. Make sure <code>pp-dishes.json</code> is next to this file.</div>`;
    return;
  }
  const q = state.q.toLowerCase();
  const list = state.dishes.filter(d =>
    (state.filter==="All" || d.category===state.filter) &&
    (q==="" || d.name.toLowerCase().includes(q))
  );
  $grid.innerHTML = list.length ? list.map(cardHTML).join('') :
    `<div class="empty">No matches. Try a different category or search.</div>`;
  enableDrag();
}

function enableDrag(){
  document.querySelectorAll('.dish').forEach(el=>{
    el.addEventListener('dragstart', e=>{
      e.dataTransfer.setData('text/plain', el.dataset.name);
    });
  });
}
function enableDrop(){
  document.querySelectorAll('.slot').forEach(slot=>{
    slot.addEventListener('dragover', e=>{ e.preventDefault(); slot.classList.add('dragover'); });
    slot.addEventListener('dragleave', ()=>slot.classList.remove('dragover'));
    slot.addEventListener('drop', e=>{
      e.preventDefault();
      slot.classList.remove('dragover');
      const name = e.dataTransfer.getData('text/plain');
      const dish = state.dishes.find(d=>d.name===name);
      if(!dish) return;
      if(dish.category !== slot.dataset.slot){
        alert(`“${dish.name}” is under ${dish.category}. Drop it in the ${dish.category} slot.`);
        return;
      }
      state.chosen[slot.dataset.slot] = dish;
      slot.innerHTML = `
        <h3>${slot.dataset.slot}</h3>
        <div class="chosen">
          <a href="${dish.url}" target="_blank" rel="noopener">
            <img src="${dish.img}" alt="${dish.name}" referrerpolicy="no-referrer"
                 onerror="this.onerror=null;this.src='${fallbackSVG('Image unavailable')}';">
          </a>
          <div class="label">
            <strong>${dish.name}</strong>
            <a href="${dish.url}" target="_blank" rel="noopener">Open recipe ↗</a>
          </div>
        </div>`;
    });
  });
}

/* Surprise Me: pick strictly by category */
$surprise.onclick = ()=>{
  CATEGORIES.forEach(cat=>{
    const pool = state.dishes.filter(d=>d.category===cat);
    if(pool.length===0) return;
    const pick = pool[Math.floor(Math.random()*pool.length)];
    const slot = [...document.querySelectorAll('.slot')].find(el=>el.dataset.slot===cat);
    state.chosen[cat]=pick;
    slot.innerHTML = `
      <h3>${cat}</h3>
      <div class="chosen">
        <a href="${pick.url}" target="_blank" rel="noopener">
          <img src="${pick.img}" alt="${pick.name}" referrerpolicy="no-referrer"
               onerror="this.onerror=null;this.src='${fallbackSVG('Image unavailable')}';">
        </a>
        <div class="label"><strong>${pick.name}</strong><a href="${pick.url}" target="_blank" rel="noopener">Open recipe ↗</a></div>
      </div>`;
  });
};
$clearAll.onclick = ()=>{ state.chosen={}; renderSlots(); };

$query.addEventListener('input', e=>{ state.q = e.target.value; renderGrid(); });

/* Rolling strip (Apple‑like) */
function buildReel(){
  if(!state.dishes.length){ $reel.innerHTML = ""; return; }
  const imgs = state.dishes.map(d=>`<a href="${d.url}" target="_blank" rel="noopener"><img src="${d.img}" alt="${d.name}" referrerpolicy="no-referrer" onerror="this.onerror=null;this.src='${fallbackSVG()}';"></a>`);
  $reel.innerHTML = imgs.concat(imgs).join(''); // duplicate for seamless loop
}

/* Load external JSON ONLY (no hardcoded seed) */
async function loadExternalJSON(){
  try{
    const res = await fetch('pp-dishes.json',{cache:'no-store'});
    if(!res.ok) throw new Error('JSON not found');
    const extra = await res.json();
    const valid = extra.filter(x=>x.name && x.img && x.url && CATEGORIES.includes(x.category));
    // de‑dupe by URL
    const byUrl = new Map();
    valid.forEach(x=>{ if(!byUrl.has(x.url)) byUrl.set(x.url,x); });
    state.dishes = [...byUrl.values()];
  }catch(e){
    state.dishes = [];
  }
}

/* Boot */
(async()=>{
  buildChips();
  renderSlots();
  await loadExternalJSON();
  // Enable controls only after data is loaded
  const hasData = state.dishes.length > 0;
  $surprise.disabled = !hasData;
  $clearAll.disabled = !hasData;
  $query.disabled = !hasData;
  if($status){ $status.remove(); }
  renderGrid();
  buildReel();
})();
</script>
</body>
</html>